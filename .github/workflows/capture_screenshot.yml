name: Capture Screenshot

on:
  workflow_dispatch:

jobs:
  capture_screenshot:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Docker
      run: |
        sudo apt-get update
        sudo apt-get install -y docker.io
        sudo systemctl start docker

    - name: Pull Acestream image
      run: sudo docker pull magnetikonline/acestream-server:3.1.49_debian_8.11

    - name: Run Acestream container
      run: |
        sudo docker run -d --name acestream -p 6878:6878 magnetikonline/acestream-server:3.1.49_debian_8.11
        sleep 10  # Espera 10 segundos para que el stream se inicie

    - name: Capture screenshot
      run: |
        ffmpeg -i http://127.0.0.1:6878/ace/getstream -vframes 1 ace_kanalak/screenshot.png

    - name: Stop Acestream container
      run: sudo docker stop acestream
